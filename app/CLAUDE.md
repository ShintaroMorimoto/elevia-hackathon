# App ディレクトリ現状分析レポート

## 現在の実装状況

### 現在存在するファイル・機能

```
app/
├── layout.tsx              # 基本レイアウト
├── page.tsx                # ログイン画面 + ダッシュボード
├── globals.css             # グローバルスタイル
├── goals/new/page.tsx      # 新規目標作成フォーム
├── chat/[id]/page.tsx      # AI深掘り対話
├── plan-generation/[id]/page.tsx  # プラン生成中表示
├── plan/[id]/page.tsx      # 計画詳細表示（一般的な計画）
└── plan/2/page.tsx         # 計画詳細表示（世界一周旅行の固定データ）
```

### 実装済みの機能

1. **認証機能（簡易版）**
   - クライアントサイドでのログイン状態管理
   - 固定的なログイン機能（実際の認証なし）

2. **目標管理機能**
   - 新規目標作成フォーム（dreams + deadline）
   - 目標一覧表示（ハードコードされたサンプルデータ）

3. **AI深掘り対話機能**
   - チャット形式のUI
   - 固定的な質問セット（5ステップ）
   - 選択肢ボタンとテキスト入力

4. **計画生成・表示機能**
   - ローディング画面（生成中の演出）
   - 階層的なOKR表示（年次 → 月次）
   - 進捗管理（チェックボックス、プログレスバー）

## CLAUDE.md 要求仕様との差分分析

### ✅ 実装済み・部分実装済み

| 要求仕様 | 実装状況 | 備考 |
|---------|---------|------|
| 3.2.1 新規目標作成 | ✅ 実装済み | goals/new/page.tsx |
| 3.2.2 目標一覧表示 | ✅ 実装済み | page.tsx のダッシュボード |
| 3.2.3 目標詳細表示（階層リストビュー） | ✅ 実装済み | plan/[id]/page.tsx |
| 3.3 AI深掘り対話機能 | ✅ 実装済み | chat/[id]/page.tsx |
| 3.4.1 AI計画生成 | 🔶 UI のみ | 実際のAI処理は未実装 |
| 3.5.1 OKRの手動編集 | 🔶 UI のみ | 編集ボタンあるが機能未実装 |
| 3.5.2 OKRステータス変更 | ✅ 実装済み | チェックボックスで完了切り替え |

### ❌ 未実装・大きなギャップ

| 要求仕様 | 現状のギャップ | 対応が必要な項目 |
|---------|-------------|----------------|
| **3.1 ユーザーアカウント機能** | | |
| 3.1.1 新規登録 | ❌ 未実装 | Google認証、メール/パスワード認証 |
| 3.1.2 ログイン/ログアウト | ❌ 擬似実装のみ | 実際の認証機能なし |
| **3.2 目標管理機能** | | |
| 3.2.4 目標編集 | ❌ 未実装 | 登録済み目標の編集機能なし |
| 3.2.5 目標削除 | ❌ 未実装 | 目標削除機能なし |
| **3.3 AI深掘り対話機能** | | |
| 3.3.3 回答保存 | ❌ 未実装 | 対話履歴の永続化なし |
| **3.4 AI計画生成機能** | | |
| 実際のAI処理 | ❌ 未実装 | 固定データのみ、実際のLLM連携なし |
| **データ永続化** | | |
| データベース | ❌ 未実装 | すべてクライアントサイドの一時データ |
| API エンドポイント | ❌ 未実装 | サーバーサイド処理なし |

## アーキテクチャ上の問題点

### 1. データ永続化の欠如
- **現状**: すべてのデータがクライアントサイドの useState で管理
- **問題**: ページリロードでデータが消失、ユーザー間でのデータ共有不可
- **必要な対応**: データベース設計・実装、API Routes の実装

### 2. 認証システムの未実装
- **現状**: ボタンクリックでログイン状態を切り替える擬似実装
- **問題**: セキュリティなし、ユーザー識別不可
- **必要な対応**: NextAuth.js などの認証ライブラリ導入

### 3. AI機能の未実装
- **現状**: 固定的な質問・回答パターン、固定データの表示
- **問題**: パーソナライゼーション不可、実際のOKR生成不可
- **必要な対応**: LLM API（OpenAI等）連携、プロンプトエンジニアリング

### 4. サーバーサイド処理の欠如
- **現状**: すべてクライアントサイドで完結
- **問題**: データ処理能力の限界、セキュリティ問題
- **必要な対応**: Server Actions、API Routes の実装

## 技術的負債・改善が必要な箇所

### 1. ハードコーディングされたデータ
- `page.tsx`: goals 配列がハードコード
- `chat/[id]/page.tsx`: 質問・回答パターンがハードコード
- `plan/[id]/page.tsx`: milestones 配列がハードコード

### 2. 型定義の不統一
- Milestone、Task、Message 等の型定義が各ファイルに分散
- 共通の型定義ファイルが必要

### 3. UI コンポーネントの重複
- 進捗表示、年次展開、編集ボタン等の UI パターンが重複
- 共通コンポーネント化が必要

### 4. エラーハンドリングの欠如
- API エラー、バリデーションエラーの処理が未実装
- Loading 状態の管理が不十分

## 非機能要件との差分

### 4.1 UI/UX要件
- **スマホファースト**: ✅ 実装済み（Tailwind の responsive design）
- **シンプルで直感的**: ✅ 概ね達成
- **階層表示**: ✅ 実装済み（アコーディオン展開）

### 4.2 パフォーマンス要件
- **画面遷移2秒以内**: 🔶 現状は達成（静的データのため）
- **AI生成15秒以内**: ❌ 実装されていない（固定タイマーのみ）

### 4.3 セキュリティ要件
- **パスワードハッシュ化**: ❌ 認証機能自体が未実装
- **データプライバシー**: ❌ 認証・認可機能が未実装

## 推奨する実装ロードマップ

### Phase 1: 基盤構築
1. データベース設計・構築（Drizzle ORM + PostgreSQL/SQLite）
2. 認証システム実装（NextAuth.js）
3. Server Actions 実装
4. 共通型定義・コンポーネント整理

### Phase 2: コア機能実装
1. 目標 CRUD 機能の完全実装
2. 対話履歴の永続化
3. AI API 連携（OpenAI/Anthropic）
4. 実際のOKR生成ロジック

### Phase 3: 品質向上
1. エラーハンドリング強化
2. バリデーション強化
3. パフォーマンス最適化
4. テスト実装

## まとめ

現在の実装は **プロトタイプ・デモレベル** であり、実際のサービスとして機能させるには大幅な改修が必要です。特に以下の3点が最重要課題です：

1. **データ永続化**: 現在のクライアントサイド完結からサーバーサイド処理への移行
2. **認証システム**: 擬似実装から実際の認証システムへの移行  
3. **AI機能**: 固定データから実際のLLM連携への移行

ただし、UI/UX の基本構造は要求仕様を満たしており、ユーザー体験の観点では良好な出発点となっています。